build: off
stack: node 14, python 3.9, jdk 8, go 1.17
skip_tags: true
environment:
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      ADO_SKIP_TESTS: docker # maven,gradle,npm,nuget,dotnet,conan,pip,proxy,distribution,unit,installer,generic,docker # #todo
      PYTHON_HOME: "C:\\Python38"
    - APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
      # ADO_SKIP_TESTS: # maven,gradle,npm,nuget,dotnet,conan,pip,proxy,distribution,unit,installer,generic,docker # #todo

  nodejs_version: "14"

  GOPATH: c:\gopath
  GOVERSION: 1.17.4
  GOROOT: c:\Program Files\Go
  # Added in order to prevent fetching the outdated dependencies versions from go cache.
  GOPROXY: direct
  GO111MODULE: on
  CGO_ENABLED: 0

  ADO_ARTIFACTORY_URL:
    secure: RIh0gGFDn2JAnLUEEqLsQnZ5H3XFWg1s+Qq8Z4i+Xu+FtQf6Tsu2AnfY4/6AaXJ8
  ADO_ARTIFACTORY_USERNAME:
    secure: YEB5Wiv9a2vNpUhy+MfL+A==
  ADO_ARTIFACTORY_PASSWORD:
    secure: Um8o75MQIieSavIemF4ySA==
  ADO_ARTIFACTORY_DOCKER_DOMAIN:
    secure: ppjr6mrLIKXVptLX8WPOlffTwOLtRIoaIpsVEvmje/9mDtLojTqpwI9OIC5VZnx1
  ADO_ARTIFACTORY_DOCKER_REPO:
    secure: UjixvF6E1Bp1p8zgPRLCVA==
  ADO_DISTRIBUTION_URL:
    secure: RIh0gGFDn2JAnLUEEqLsQrfLmtDrzDd5Qphea4gOE0Lu1Uz2Xa/y+D0Mld917gwy

install:
  - cmd: set PATH=%PYTHON_HOME%;%PYTHON_HOME%\Scripts;%PATH%
  - python -m pip install --upgrade pip
  - cmd: powershell Install-Product node $env:nodejs_version
  - npm i -gq jfrog-cli-v2-jf
  - pip install conan -q
  - cmd: nuget update -self
  - sh: conan profile new default --detect # This command produces a warning that is handled by the following command.
  - sh: conan profile update settings.compiler.libcxx=libc++ default
  # Download requested golang version:
  - cmd: rmdir c:\go /s /q
  - cmd: appveyor DownloadFile https://storage.googleapis.com/golang/go%GOVERSION%.windows-amd64.msi
  - cmd: msiexec /i go%GOVERSION%.windows-amd64.msi /q
  - cmd: set PATH=%GOPATH%\bin;c:\Program Files\Go\bin;%PATH%
  - cmd: go version

services:
  - docker

test_script:
  - jf -v
  - cmake --version
  - go version
  - pip -V
  - python -V
  - conan -v
  - node --version
  - npm --version
  - npm t
  - npm run create # Assert the extension is created successfully
  - npm run lint # Assert code is linted
